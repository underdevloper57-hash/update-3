<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AlphaFlow – Real-Time News</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    /* --- THEME VARIABLES --- */
    :root {
      --bg: #020617;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --glass: rgba(15, 23, 42, 0.6);
      --border: rgba(148, 163, 184, 0.1);
      --bullish: #00E396;
      --bearish: #FF4560;
      --neutral: #facc15;
    }
    
    body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }
    * { box-sizing: border-box; }
    
    #bgCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.8; pointer-events: none; }
    
    /* --- CURSOR SPOTLIGHT --- */
    .trail-cursor {
      width: 400px; height: 400px; border-radius: 50%;
      position: fixed; pointer-events: none;
      transform: translate(-50%, -50%);
      background: radial-gradient(circle, rgba(56, 189, 248, 0.15), transparent 70%);
      z-index: 1; display: none;
    }
    @media (hover: hover) { .trail-cursor { display: block; } }

    /* --- NAV --- */
    .nav-bar {
        position: sticky; top: 0; padding: 1rem 2rem;
        background: rgba(2,6,23,0.95); backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border);
        z-index: 100; display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-weight: 800; font-size: 1.1rem; color: #fff; text-decoration: none; display: flex; gap: 10px; align-items: center; }
    .logo { width: 12px; height: 12px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 15px var(--accent); }
    .nav-link { color: var(--muted); text-decoration: none; font-size: 0.85rem; transition: 0.3s; cursor: pointer; border: 1px solid var(--border); padding: 6px 12px; border-radius: 6px; } 
    .nav-link:hover { color: var(--accent); border-color: var(--accent); background: rgba(56, 189, 248, 0.1); }

    /* --- CONTAINER --- */
    .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
    
    /* --- HEADER SECTION --- */
    .header-row {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border);
        position: relative; z-index: 5;
    }
    .header-title h1 {
        font-size: 2rem; margin: 0; font-weight: 800;
        background: linear-gradient(to right, #fff, #94a3b8);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .header-controls { display: flex; align-items: center; gap: 15px; }
    #last-updated { font-size: 0.8rem; color: var(--muted); font-family: 'JetBrains Mono'; }
    
    .refresh-btn {
        background: var(--accent); color: #000; border: none;
        padding: 10px 20px; border-radius: 8px; font-weight: 700; font-size: 0.85rem;
        cursor: pointer; display: flex; align-items: center; gap: 8px;
        transition: all 0.3s ease; box-shadow: 0 0 15px rgba(56, 189, 248, 0.3);
    }
    .refresh-btn:hover { transform: translateY(-2px); box-shadow: 0 0 25px rgba(56, 189, 248, 0.5); background: #fff; }
    .spin-icon { transition: transform 0.5s ease; }
    .refresh-btn:hover .spin-icon { transform: rotate(180deg); }

    /* --- NEWS GRID --- */
    .news-grid {
        display: grid;
        /* Auto-fit columns */
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
        gap: 30px;
        padding-bottom: 50px;
        align-items: start; /* Prevents cards from stretching height to match row */
    }
    
    /* --- HOVER FOCUS EFFECT --- */
    /* Dim siblings when hovering grid */
    .news-grid:hover .news-card {
        opacity: 0.3;
        filter: blur(2px) grayscale(0.8);
        transform: scale(0.98);
    }
    
    /* Highlight the hovered card */
    .news-grid .news-card:hover {
        opacity: 1;
        filter: none;
        transform: scale(1.02) translateY(-5px);
        z-index: 20; /* Bring to front */
        box-shadow: 0 30px 60px rgba(0,0,0,0.9);
        border-color: var(--accent);
        background: rgba(15, 23, 42, 0.95); /* Solidify background to read text */
    }

    /* --- MODERN NEWS CARD --- */
    .news-card {
        background: linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 24px;
        position: relative;
        overflow: hidden;
        /* Smooth expansion transition */
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        backdrop-filter: blur(12px);
        display: flex; flex-direction: column;
        
        /* Compact height initially */
        min-height: 180px;
        max-height: 200px; 
        
        /* Spotlight vars */
        --mouse-x: 0px;
        --mouse-y: 0px;
    }
    
    /* EXPAND ON HOVER */
    .news-card:hover {
        max-height: 800px; /* Allow growth */
    }
    
    /* Spotlight Gradient Overlay */
    .news-card::before {
        content: "";
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: radial-gradient(
            800px circle at var(--mouse-x) var(--mouse-y), 
            rgba(56, 189, 248, 0.1), 
            transparent 40%
        );
        z-index: 1;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
    }
    .news-card:hover::before { opacity: 1; }

    /* Sentiment Glow Bar */
    .sentiment-bar {
        position: absolute; top: 0; left: 0; width: 100%; height: 4px;
        background: var(--neutral); box-shadow: 0 0 15px var(--neutral);
    }

    /* Badge */
    .sentiment-badge {
        position: absolute; top: 0; right: 0;
        padding: 6px 14px;
        border-bottom-left-radius: 16px;
        font-size: 0.65rem; font-weight: 800; text-transform: uppercase;
        letter-spacing: 1px; backdrop-filter: blur(5px);
        color: #000; z-index: 5;
    }

    /* Header Content */
    .card-meta { display: flex; justify-content: space-between; margin-bottom: 15px; margin-top: 5px; font-size: 0.75rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; position: relative; z-index: 3; }
    .source { font-weight: 700; color: #fff; }

    .headline {
        font-size: 1.2rem; font-weight: 700; color: #fff; margin-bottom: 0;
        line-height: 1.4; position: relative; z-index: 3;
        transition: margin 0.3s;
    }
    .news-card:hover .headline { margin-bottom: 20px; color: var(--accent); }
    .headline a { text-decoration: none; color: inherit; }
    
    /* HIDDEN CONTENT (Reveals on Hover) */
    .hidden-content {
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.4s ease 0.1s; /* Delay slightly */
        display: flex; flex-direction: column; gap: 20px;
        position: relative; z-index: 3;
        margin-top: 10px;
    }

    .news-card:hover .hidden-content {
        opacity: 1;
        transform: translateY(0);
    }
    
    /* AI Summary Box */
    .ai-box {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 8px; padding: 15px;
        border-left: 2px solid var(--accent);
    }
    .ai-summary-text {
        font-size: 0.9rem; color: #e2e8f0; line-height: 1.6; margin-bottom: 10px;
    }

    .impact-row {
        display: flex; justify-content: space-between; align-items: center;
        border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;
    }
    
    .impact-label { font-size: 0.65rem; color: var(--muted); text-transform: uppercase; }
    .impact-val { font-family: 'JetBrains Mono'; font-weight: bold; font-size: 0.85rem; color: #fff; }

    /* Read More Button */
    .read-btn {
        display: block; text-align: center;
        text-decoration: none; font-size: 0.85rem; font-weight: 800;
        background: var(--accent); color: #000;
        padding: 12px; border-radius: 8px;
        transition: 0.3s; text-transform: uppercase; letter-spacing: 1px;
        box-shadow: 0 5px 20px rgba(56, 189, 248, 0.2);
    }
    .read-btn:hover {
        background: #fff; transform: scale(1.02);
        box-shadow: 0 5px 30px rgba(255, 255, 255, 0.4);
    }

    /* LOADER */
    .loader-container { text-align: center; margin-top: 100px; display: none; }
    .spinner {
        width: 40px; height: 40px; border: 3px solid rgba(56,189,248,0.3);
        border-top: 3px solid var(--accent); border-radius: 50%;
        animation: spin 1s linear infinite; margin: 0 auto 15px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .scan-text { color: var(--accent); font-family: 'JetBrains Mono'; font-size: 0.9rem; letter-spacing: 1px; animation: pulse 2s infinite; }
    @keyframes pulse { 50% { opacity: 0.5; } }

    /* SENTIMENT COLORS */
    .bullish-glow { background: var(--bullish); box-shadow: 0 0 20px var(--bullish); }
    .bearish-glow { background: var(--bearish); box-shadow: 0 0 20px var(--bearish); }
    .neutral-glow { background: var(--neutral); box-shadow: 0 0 20px var(--neutral); }
    .bullish-text { color: var(--bullish); }
    .bearish-text { color: var(--bearish); }
    .neutral-text { color: var(--neutral); }
    
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

  </style>
</head>
<body>

  <div class="trail-cursor" id="trail-cursor"></div>
  <canvas id="bgCanvas"></canvas>

  <div class="nav-bar">
      <a href="/" class="brand"><div class="logo"></div> AlphaFlow</a>
      <a href="/dashboard" class="nav-link">Dashboard →</a>
  </div>

  <div class="container">
      
      <!-- HEADER -->
      <div class="header-row">
          <div class="header-title">
              <h1>News Agent</h1>
          </div>
          <div class="header-controls">
              <div id="last-updated">Connecting...</div>
              <button class="refresh-btn" onclick="manualRefresh()">
                  <span class="spin-icon">↻</span> Refresh
              </button>
          </div>
      </div>

      <!-- LOADER -->
      <div id="loader" class="loader-container">
          <div class="spinner"></div>
          <div class="scan-text">NEURAL NETWORKS SCANNING GLOBAL FEEDS...</div>
      </div>

      <!-- GRID -->
      <div class="news-grid" id="newsFeed"></div>
  </div>

  <script>
    /* --- 1. CURSOR TRACKING FOR CARDS --- */
    document.addEventListener('mousemove', e => {
        const cursor = document.getElementById('trail-cursor');
        if(cursor) { cursor.style.top = e.clientY + 'px'; cursor.style.left = e.clientX + 'px'; }
        
        // Spotlight effect for cards
        document.querySelectorAll('.news-card').forEach(card => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            card.style.setProperty('--mouse-x', `${x}px`);
            card.style.setProperty('--mouse-y', `${y}px`);
        });
    });

    /* --- 2. LIVE WALLPAPER --- */
    (function(){ 
        const canvas=document.getElementById('bgCanvas');const ctx=canvas.getContext('2d');
        let w,h; const nodes = [];
        function resize(){ w=window.innerWidth;h=window.innerHeight; canvas.width=w;canvas.height=h; createNodes(); }
        function createNodes() {
            nodes.length = 0; const count = Math.floor(w * h / 12000);
            for(let i=0; i<count; i++) {
                nodes.push({ x: Math.random()*w, y: Math.random()*h, vx: (Math.random()-0.5)*0.8, vy: (Math.random()-0.5)*0.8, size: Math.random()*2.5 + 0.5 });
            }
        }
        function draw(){ 
            ctx.clearRect(0,0,w,h); ctx.fillStyle='rgba(56,189,248,0.6)'; ctx.strokeStyle='rgba(56,189,248,0.25)';
            nodes.forEach((node, i) => {
                node.x += node.vx; node.y += node.vy;
                if(node.x < 0 || node.x > w) node.vx *= -1; if(node.y < 0 || node.y > h) node.vy *= -1;
                ctx.beginPath(); ctx.arc(node.x, node.y, node.size, 0, Math.PI*2); ctx.fill();
                for(let j=i+1; j<nodes.length; j++) {
                    const dx = node.x - nodes[j].x; const dy = node.y - nodes[j].y; const dist = Math.sqrt(dx*dx + dy*dy);
                    if(dist < 120) { ctx.lineWidth = 1 - (dist/120); ctx.beginPath(); ctx.moveTo(node.x, node.y); ctx.lineTo(nodes[j].x, nodes[j].y); ctx.stroke(); }
                }
            }); requestAnimationFrame(draw);
        } 
        window.addEventListener('resize',resize); resize(); draw();
    })();

    /* --- 3. NEWS LOGIC --- */
    function manualRefresh() {
        const btn = document.querySelector('.refresh-btn .spin-icon');
        btn.style.transition = 'none'; btn.style.transform = 'rotate(0deg)';
        setTimeout(() => { btn.style.transition = 'transform 0.5s ease'; btn.style.transform = 'rotate(360deg)'; }, 10);
        loadNews(true);
    }

    async function loadNews(showLoader = true) {
        const feed = document.getElementById('newsFeed');
        const loader = document.getElementById('loader');
        
        if (showLoader) {
            feed.style.opacity = '0.5'; loader.style.display = 'block';
            if(feed.children.length === 0) feed.style.display = 'none';
        }

        try {
            const res = await fetch('/api/news_analysis'); const data = await res.json();
            feed.style.opacity = '1'; feed.style.display = 'grid'; loader.style.display = 'none';
            document.getElementById('last-updated').innerText = "Synced: " + new Date().toLocaleTimeString();

            if(data.length === 0) { feed.innerHTML = "<p style='text-align:center;color:white;grid-column:1/-1;'>Connecting to global feeds...</p>"; return; }
            
            feed.innerHTML = ""; 
            data.forEach((item, index) => {
                const isBull = item.sentiment === "Bullish";
                const isBear = item.sentiment === "Bearish";
                let glowClass = 'neutral-glow'; let textClass = 'neutral-text'; let bgColor = '#facc15';
                if (isBull) { glowClass = 'bullish-glow'; textClass = 'bullish-text'; bgColor='#00E396'; }
                if (isBear) { glowClass = 'bearish-glow'; textClass = 'bearish-text'; bgColor='#FF4560'; }

                const card = document.createElement('div'); card.className = 'news-card';
                card.style.animation = `fadeInUp 0.5s ease forwards ${index * 0.05}s`; card.style.opacity = '0';
                
                card.innerHTML = `
                    <div class="sentiment-badge" style="background:${bgColor}">${item.sentiment}</div>
                    <div class="sentiment-bar ${glowClass}"></div>
                    <div class="card-meta">
                        <span class="source">${item.source}</span>
                        <span>${item.timestamp}</span>
                    </div>
                    <div class="headline">${item.headline}</div>
                    <div class="hidden-content">
                        <div class="ai-box">
                            <div class="ai-summary-text">"${item.summary}"</div>
                            <div class="impact-row">
                                <div><span class="impact-label">TARGET ASSET</span><br><span class="impact-val">${item.affected_stock}</span></div>
                                <div style="text-align:right;"><span class="impact-label">AI SENTIMENT</span><br><span class="impact-val ${textClass}">${item.sentiment} (${item.score}%)</span></div>
                            </div>
                        </div>
                        <a href="${item.link}" target="_blank" class="read-btn">READ COMPLETE ARTICLE →</a>
                    </div>
                `;
                feed.appendChild(card);
            });
        } catch(e) { loader.innerHTML = "<span style='color:#FF4560'>Connection lost. Retrying...</span>"; setTimeout(() => loadNews(false), 3000); }
    }
    
    const style = document.createElement('style');
    style.innerHTML = `@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }`;
    document.head.appendChild(style);
    
    loadNews();
    setInterval(() => loadNews(false), 60000); 
  </script>
</body>
</html>